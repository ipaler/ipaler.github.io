<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 数据库 | ipaler]]></title>
  <link href="http://ipaler.com/blog/categories/数据库/atom.xml" rel="self"/>
  <link href="http://ipaler.com/"/>
  <updated>2014-10-30T18:39:13+08:00</updated>
  <id>http://ipaler.com/</id>
  <author>
    <name><![CDATA[HENRY_HUANGS]]></name>
    <email><![CDATA[huangyijie1989@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[MYSQL主从同步错误解决]]></title>
    <link href="http://ipaler.com/blog/2012/11/15/mysql-slave-1/"/>
    <updated>2012-11-15T19:57:00+08:00</updated>
    <id>http://ipaler.com/blog/2012/11/15/mysql-slave-1</id>
    <content type="html"><![CDATA[<p>首先，如果遇到主键冲突：
<code>Last_SQL_Error: Error 'Duplicate entry '1001-164761-0' for key 'PRIMARY'' on query. Default database: 'bug'. Query: 'insert into misdata (uid,mid,pid,state,mtime) values (164761,1001,0,-1,1262623560)'</code></p>

<p><strong>A.可以先将冲突的记录删除，然后再进行一下方法：</strong></p>

<p>进入主库锁表，</p>

<p>FLUSH TABLES WITH READ LOCK;</p>

<!--more-->


<p>mysql>show master status;</p>

<p>+-------------------+-----------+--------------+------------------+</p>

<p>| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |</p>

<p>+-------------------+-----------+--------------+------------------+</p>

<p>| ufo.000063 | 159164526 | | |</p>
+-------------------+-----------+--------------+------------------+</p>

<p>1 row in set (0.00 sec)</p>
进入从库</p>

<p>mysql>slave stop;</p>

<p>mysql>change master to master_log_file='ufo.000063', master_log_pos=159164526;</p>

<p>完成上面这些后</p>

<p>mysql>slave start;</p>

<p>回到主库</p>

<p>unlock tables; 解锁</p>

<p>回到从库查看</p>

<p>show slave status \G;</p>

<p><strong>B.另外，可以在热备时跳过冲突的记录：</strong></p>

<p>slave stop;</p>

<p>set global sql_slave_skip_counter=10;  //跳过10个错误</p>

<p>slave start;</p>

<p>show slave status \G;</p>

<p><strong>C.修改从库的/etc/my.cnf文件</strong></p>

<p>在[mysqld]下面加入slave-skip-errors = 1062 (忽略所有的1062错误)</p>

<p>重启下从库的mysql</p>

<p><strong>D.修改binlog_format的格式为mixed</strong></p>

<p>进入从库查看show global variables like 'binlog_format'，如果是statement，修改从库的 my.cfg，在[mysqld]下面添加binlog_format=mixed，然后重启数据库</p>
]]></content>
  </entry>
  
</feed>
